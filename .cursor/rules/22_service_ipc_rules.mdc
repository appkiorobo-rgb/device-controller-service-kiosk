---
alwaysApply: true
---
# SERVICE IPC RULES

## Transport
- Use HTTP + WebSocket for IPC communication
- HTTP Server: `http://localhost:8080`
- HTTP API Endpoint: `POST /api/command` for Commands/Responses
- WebSocket Endpoint: `/ws` for Events (server â†’ client, one-way)

## Dual channels
- Commands/Responses: HTTP POST requests
- Events: WebSocket broadcast (async, state changes)

## Idempotency
- Every command MUST include commandId.
- Service MUST NOT re-execute the same commandId.
- On duplicate commandId: return the previously computed response.

## Events
- Events may be duplicated or reordered.
- Client must rely on State Snapshot as source of truth.
- Service MUST provide state snapshot query.
- Events are broadcast to all connected WebSocket clients.

## Versioning
- Include protocolVersion in every message.
- Add fields as optional to preserve backward compatibility.